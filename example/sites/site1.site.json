{
  "name": "Site1",
  "release": "https://example.test/this_whole_string_is_replaced_with_an_absolute_file_path_in_terra.sh",
  "contact": {
    "owner": "site1@example.test",
    "technical": "site1@example.test"
  },
  "server_name": "site1.example.test",
  "domain_list": [
    "site1.example.test"
  ],
  "env": [
    {
      "name": "NGINX_HOST",
      "value": "localhost"
    },
    {
      "name": "REDIS_HOST",
      "value": "not-applicable"
    },
    {
      "name": "REDIS_URL_DEFAULT_USER",
      "value": "unix:///run/redis/$SLUGNAME.sock?db=0"
    },
    {
      "name": "CHILL_STATIC_TRY_FILES_LAST_PARAM",
      "value": "=404"
    },
    {
      "name": "CHILL_STATIC_PATH",
      "value": "/"
    },
    {
      "name": "CHILL_STATIC_SCHEME",
      "value": "http"
    },
    {
      "name": "CHILL_STATIC_HOST",
      "value": "localhost"
    },
    {
      "name": "CHILL_STATIC_PORT",
      "value": "38011"
    },
    {
      "name": "CHILL_DYNAMIC_PATH",
      "value": "/dynamic/"
    },
    {
      "name": "CHILL_DYNAMIC_PORT",
      "value": "38012"
    },
    {
      "name": "CHILL_DYNAMIC_SCHEME",
      "value": "http"
    },
    {
      "name": "CHILL_DYNAMIC_HOST",
      "value": "localhost"
    },
    {
      "name": "API_PATH",
      "value": "/api/"
    },
    {
      "name": "API_PORT",
      "value": "38013"
    },
    {
      "name": "API_SCHEME",
      "value": "http"
    },
    {
      "name": "API_HOST",
      "value": "localhost"
    },
    {
      "name": "IMMUTABLE_EXAMPLE_PORT",
      "value": "38014"
    },
    {
      "name": "IMMUTABLE_EXAMPLE_PATH",
      "value": "/immutable-example/v1/$IMMUTABLE_EXAMPLE_HASH/"
    },
    {
      "name": "IMMUTABLE_EXAMPLE_HOST",
      "value": "https://$IMMUTABLE_BUCKET_DOMAIN_NAME"
    },
    {
      "name": "IMMUTABLE_EXAMPLE_URL",
      "value": "https://$IMMUTABLE_BUCKET_DOMAIN_NAME/$SLUGNAME/immutable/immutable-example/$IMMUTABLE_EXAMPLE_HASH/"
    },
    {
      "name": "IMMUTABLE_EXAMPLE_HASH",
      "value": "",
      "cmd": "make --silent --directory=immutable-example --no-print-directory inspect.HASH"
    },
    {
      "name": "PROXY_CACHE_VALID",
      "value": "1y"
    }
  ],
  "crontab": [
    "*/5 * * * * wget -qS --header 'Host: $SERVER_NAME:$SERVER_PORT' --post-data '' --no-check-certificate -O - http://$NGINX_HOST:$SERVER_PORT/api/internal/start-job-with-worker/example/"
  ],
  "redis": {
    "maxmemory": "2mb",
    "maxmemory-policy": "allkeys-lfu"
  },
  "workers": [
    {
      "name": "worker",
      "lang": "python-worker",
      "handler": "worker",
      "secrets_config": "worker.secrets.cfg",
      "secrets_export_dockerfile": "secrets.Dockerfile",
      "niceness": 0,
      "count": 1,
      "run-cmd": "arq main.WorkerSettings",
      "manifest": "MANIFEST",
      "environment": [
        {
          "name": "VIRTUAL_ENV_BIN",
          "value": "/usr/local/src/$SLUGNAME/worker/.venv/bin"
        }
      ]
    }
  ],
  "services": [
    {
      "name": "immutable-example",
      "lang": "immutable",
      "handler": "immutable-example",
      "environment": [
        {
          "name": "HOST",
          "value": "$IMMUTABLE_EXAMPLE_HOST"
        }
      ]
    },
    {
      "name": "api",
      "lang": "python",
      "handler": "api",
      "secrets_config": "api.secrets.cfg",
      "secrets_export_dockerfile": "secrets.Dockerfile",
      "niceness": 10,
      "worker_class": "gevent",
      "workers": 2,
      "max_requests": 50,
      "max_requests_jitter": 11,
      "log_level": "info",
      "manifest": "MANIFEST",
      "environment": [
        {
          "name": "PORT",
          "value": "$API_PORT"
        },
        {
          "name": "FLASK_APP",
          "value": "site1_api.app"
        },
        {
          "name": "FLASK_DEBUG",
          "value": "false"
        },
        {
          "name": "FLASK_INSTANCE_PATH",
          "value": "/var/lib/$SLUGNAME/api"
        }
      ]
    },
    {
      "name": "chillstatic",
      "lang": "chill",
      "handler": "chill-static-example",
      "manifest": "MANIFEST",
      "environment": [
        {
          "name": "freeze",
          "value": "true"
        },
        {
          "name": "HOST",
          "value": "$CHILL_STATIC_HOST"
        },
        {
          "name": "CHILL_HOST",
          "value": "localhost"
        },
        {
          "name": "CHILL_PORT",
          "value": "$CHILL_STATIC_PORT"
        }
      ]
    },
    {
      "name": "chilldynamic",
      "lang": "chill",
      "handler": "chill-dynamic-example",
      "manifest": "MANIFEST",
      "environment": [
        {
          "name": "freeze",
          "value": "false"
        },
        {
          "name": "HOST",
          "value": "$CHILL_DYNAMIC_HOST"
        },
        {
          "name": "CHILL_HOST",
          "value": "localhost"
        },
        {
          "name": "CHILL_PORT",
          "value": "$CHILL_DYNAMIC_PORT"
        },
        {
          "name": "CHILL_PUBLIC_URL_PREFIX",
          "value": "$CHILL_DYNAMIC_PATH"
        }
      ]
    }
  ]
}
